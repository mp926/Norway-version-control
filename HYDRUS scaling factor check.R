# Checking the scaling factor implementation in HYDRUS vs measured data
# Hypothesis: HYDRUS takes the water retention characteristic curve and multiplies it by the 
# given scaling factor at each node


coords<-read.csv('measurement coords.csv')
coords<-coords[84:121,] # isolate the 2016 lab data
coords$y<-coords$y-200 # subtract the additional 200cm added on for the SGEMs grids

coords$sfth_krig<-c(1.02161000000000, 1.03482000000000,0.973729000000000,0.977854000000000,
              1.05142000000000,	0.943594000000000,	0.983486000000000,	1.05119000000000,
              0.959287000000000,	1.04103000000000,	0.931459000000000,	1.02880000000000,
              1.04003000000000,	1.00387000000000,	1.02464000000000,	1.02860000000000,
              1.01902000000000,	0.989695000000000,	1.05955000000000,	1.03417000000000,
              1.07502000000000,	0.966352000000000,	1.01071000000000,	1.04347000000000,
              0.977435000000000,	1.02034000000000,	0.949503000000000,	1.05106000000000,
              0.995198000000000,	0.975919000000000,	0.970909000000000,	1.05163000000000,
              0.961903000000000,	1.06591000000000,	0.953016000000000,	0.963409000000000,
              0.965926000000000,	1.04047000000000)

coords$sfh_krig<-c(0.864576000000000,	0.971884000000000,	1.15210000000000,	1.12877000000000,
              0.823303000000000,	1.06321000000000,	1.18090000000000,	0.741335000000000,
              1.16657000000000,	0.852764000000000,	1.48712000000000,	0.868481000000000,
              0.927758000000000,	1.93374000000000,	0.990300000000000,	0.959574000000000,
              0.949698000000000,	1.09608000000000,	0.853971000000000,	0.916532000000000,
              0.791040000000000,	1.00380000000000,	0.835697000000000,	0.866337000000000,
              1.35042000000000,	0.887041000000000,	1.51224000000000,	1.30318000000000,
              1.03171000000000,	1.36698000000000,	0.938159000000000,	0.812241000000000,
              1.11283000000000,	0.843895000000000,	1.38808000000000,	1.19791000000000,
              1.54977000000000,	0.841974000000000)

coords$sfh_vogel<-c(0.664791945,	0.941863153,	0.964412213,	1.318137591,
                    0.619504417,	1.359149591,	1.446932672,	0.516634581,
                    1.39212071,	0.62014785,	2.614735484,	0.702628174,
                    0.795913806,	3.463557222,	1.031979976,	0.903913134,
                    0.893949708,	1.246916297,	0.682502453,	0.782260968,
                    0.668872188,	1.009042895,	0.609476426,	0.662947291,
                    2.347521265,	0.71236146,	2.383373351,	1.774330318,
                    0.973936319,	1.92580363,	0.847205593,	0.548736209,
                    1.243192025,	0.692536696,	1.922392978,	1.376337298,
                    2.478293116,	0.618971006)

coords$sfth_vogel<-c(1.104308745,	1.170248054,	1.001577179,	0.926627252,
                     1.243707086,	0.913310107,	0.9466684,	1.154476426,
                     0.896913658,	1.130071848,	0.901498279,	1.152239729,
                     1.214144612,	1.016658458,	1.06225836,	1.095029349,
                     1.115358191,	0.970706536,	1.189366655,	1.098426688,
                     1.163780261,	0.89178016,	1.035868102,	1.134205209,
                     0.685208138,	1.065793488,	0.846258959,	1.032072897,
                     0.985123895,	0.961996509,	0.907503737,	1.119841506,
                     0.914963931,	1.129267592,	0.858878943,	0.903556414,
                     0.881364378,	1.141957675)


#check scaling factors for bias
plot(coords$sfth_krig,coords$sfth_vogel)
abline(0,1)
plot(coords$sfh_krig,coords$sfh_vogel)
abline(0,1)


ref.curve<-c(7.52E-8,0.3866,8.1052E-4,1.3723) #thr ths alpha n
h=seq(from=0, to=100000, by=10)

th.h=(1/(1+(ref.curve[3]*h)^ref.curve[4])^(1-1/ref.curve[4])) *((ref.curve[2]-ref.curve[1])+ref.curve[1])

h.sc<-list()
th.sc<-list()
for (i in 1:dim(coords)[1]){
  h.sc[[i]]<-h*coords$sfh[i]
  th.sc[[i]]<-th.h*coords$sfth[i]
}

plot(log10(h),th.h,ylim=c(0,0.45))
for (i in 1:dim(coords)[1]){
  lines(log10(h.sc[[i]]),th.sc[[i]], col="red")
}
points(log10(h),th.h)




